/**
* Created with thress.
* User: jupegarnica
* Date: 2014-08-05
* Time: 10:31 PM
*/
'<!doctype html>\n<html>\n  <head>\n    <title>JS1k, [classic] : demo submission [1667]</title>\n    <meta charset=&quot;utf-8&quot; />\n    <style>\n      html, body { margin: 0; padding: 0; border: 0; width: 100%25; height: 100%25; }\n      %23c { display: block; } /* kill scrollbars from hell */\n    </style>\n  </head>\n  <body>\n    <canvas id=&quot;c&quot;></canvas>\n    <script>\n      var a = document.getElementsByTagName(\'canvas\')[0];\n      var b = document.body;\n      var d = function(e){ return function(){ e.parentNode.removeChild(e); }; }(a);\n      // unprefix some popular vendor prefixed things (but stick to their original name)\n      var AudioContext =\n        window.AudioContext ||\n          window.webkitAudioContext;\n      var requestAnimationFrame =\n        window.requestAnimationFrame ||\n          window.mozRequestAnimationFrame ||\n          window.webkitRequestAnimationFrame ||\n          window.msRequestAnimationFrame ||\n          function(f){ setTimeout(f, 1000/30); };\n      // fix bug in safari: http://qfox.nl/weblog/218\n      document.body.clientWidth;\n      // auto resize (original) canvas. call `onresize(w,h) to limit the size of the canvas\n      (window.onorientationchange = window.onresize = function(a){\n        var mw = Infinity;\n        var mh = Infinity;\n        var min = Math.min;\n\n        return function(w,h){\n          if (arguments.length === 2) {\n            mw = w;\n            mh = h;\n          }\n          a.style.width = (a.width = min(mw, innerWidth)) + \'px\';\n          a.style.height = (a.height = min(mh, innerHeight)) + \'px\';\n        };\n      }(a))();\n\n      var c = a.getContext(\'2d\');\n    </script>\n    <script>\n      // start of submission //\nb.bgColor=&quot;%23eee&quot;;c.font=&quot;17pt cursive&quot;;c.textAlign=&quot;center&quot;;E=&quot;&quot;;S=&quot;fillStyle&quot;;c.T=c.fillText;c.R=c.fillRect;V=&quot;%23000&quot;;W=&quot;%23FFF&quot;;X=&quot;%23DDD&quot;;Y=&quot;%23F68&quot;;Z=&quot;%237CF&quot;;M=Math;R=M.random;H=3;U=G();function G(a){for(g=M.ceil(3*R());2<g&amp;&amp;g<H&amp;&amp;0.4>R();)g*=2;return a%3Fg-2:g}function O(a){p=s=0;for(k=1;5>k;k++){if(k==a||!a){for(i=4;i--;)for(v=F[i],m=0;4>m;m++)if(n=m+1,!v[m]&amp;&amp;v.slice(m).join(E)-0&amp;&amp;(a&amp;&amp;F[i].splice(m,1)&amp;&amp;(F[i][3]=0),s=m=5),3<=v[m]&amp;&amp;v[m]==v[n]||3==v[m]+v[n])a&amp;&amp;F[i].splice(m,2,F[i][m]+F[i][n])&amp;&amp;(F[i][3]=0),s=m=5;if(a&amp;&amp;s){for(i=G();F[i%254][3];)i++;F[i%254][3]=U;U=G()}}n=[];for(i=0;4>i;i++)for(n[i]=[],j=0;4>j;j++)m=F[j][3-i],n[i][j]=m-0,H=M.max(H,m),c[S]=[X,Z,Y][m]||W,c.R(2+42*j,2+47*i,40,45),c[S]=3>m%3FW:11<m&amp;&amp;m==H%3FY:V,c.T(m||E,23+42*j,30+47*i,40),p+=3>m%3F0:M.pow(3,M.log(m/3)/M.LN2+1);F=n}c[S]=[X,Z,Y][U]||W;c.R(200,30,40,45);return s}c.T(&quot;Next&quot;,220,23);F=(E+33211E7).split(E);F.push(G(),G(),G(),G());F.sort(G);for(z=4;z--;)F.push(F.splice(0,4));O();onkeyup=function(a){w=a.which;41>w&amp;&amp;36<w&amp;&amp;(O(w-36),O()||alert(&quot;Score: &quot;+p))}\n      // end of submission //\n    </script>\n  </body>\n</html>\n